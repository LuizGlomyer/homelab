- name: Remove distro Go if present
  ansible.builtin.apt:
    name: golang-go
    state: absent
    purge: true

- name: Remove previous manual Go installation
  ansible.builtin.file:
    path: "{{ go_install_dir }}/go"
    state: absent

- name: Download Go tarball
  ansible.builtin.get_url:
    url: "{{ go_url }}"
    dest: "/tmp/{{ go_tarball }}"
    mode: "0644"

- name: Extract Go
  ansible.builtin.unarchive:
    src: "/tmp/{{ go_tarball }}"
    dest: "{{ go_install_dir }}"
    remote_src: true

- name: Ensure Go is in system PATH
  ansible.builtin.copy:
    dest: /etc/profile.d/go.sh
    content: |
      export PATH=/usr/local/go/bin:$PATH
    mode: "0644"

- name: Verify Go installation
  ansible.builtin.command: /usr/local/go/bin/go version
  register: go_check
  changed_when: false

- name: Show Go version
  ansible.builtin.debug:
    var: go_check.stdout
