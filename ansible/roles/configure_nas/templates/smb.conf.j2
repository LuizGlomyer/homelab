[global]
   workgroup = WORKGROUP
   server role = standalone server
   netbios name = NAS-01
   server string = Homelab NAS

   security = user
   passdb backend = tdbsam
   map to guest = never
   server min protocol = SMB2
   hosts allow = 192.168.0.0/24
   hosts deny = 0.0.0.0/0

   logging = file
   log file = /var/log/samba/log.%m
   max log size = 5000
   log level = 1 auth:3

   unix extensions = yes
   ea support = yes
   store dos attributes = yes
   inherit permissions = yes
   inherit acls = yes
   map acl inherit = yes

   load printers = no
   disable spoolss = yes

   # NTFS ACL support
   vfs objects = acl_xattr recycle

   recycle:repository = .recycle/%U
   recycle:keeptree = yes
   recycle:versions = yes
   recycle:touch = yes
   recycle:maxsize = 0

[{{ nas_storage_share }}]
   path = {{ nas_root }}
   browseable = yes
   read only = no
   valid users = {{ nas_admin_user }}

{% for share in nas_shares %}
[{{ share.name }}]
   path = {{ share.path }}
   browseable = yes
   read only = {{ 'yes' if share.read_only | default(true) else 'no' }}
   guest ok = no

   create mask = 0660
   directory mask = 2770
   valid users = @{{ share.domain_group }} {{ nas_admin_user }}
{% endfor %}
